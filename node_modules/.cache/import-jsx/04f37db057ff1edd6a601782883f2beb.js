'use strict';

const child = require('child_process');

const {
  cpuUsage
} = require('process');

let diskspace = require('diskspace');

const fs = require('fs');

let os = require('os-utils');

let _os = require('os');

const React = require('react');

const {
  render,
  useFocus,
  Text,
  Box
} = require('ink');

const Divider = require('ink-divider');

const Gradient = require('ink-gradient');

const BigText = require('ink-big-text'); // const Ascii = require('ink-ascii')


const Spinner = require('ink-spinner');

const cliSpinners = require('cli-spinners');

const App = () => {
  const [cpuInfo, setCpuInfo] = React.useState('');
  const [diskInfo, setDiskInfo] = React.useState({});
  const [diskArr, setDiskArr] = React.useState([]);
  const [memInfo, setMemInfo] = React.useState('');
  const [font, setFont] = React.useState('');
  const [count, setCount] = React.useState(0);
  const [fonts, setFonts] = React.useState(['block', 'slick', 'tiny', 'grid', 'pallet', 'shade', 'simple', 'simpleBlock', '3d', 'simple3d', 'chrome', 'huge']);
  React.useEffect(() => {
    setInterval(() => {
      checkSys();
      checkFreeMem(); //setCount(prev => prev+1)
    }, 1000);
  }, []);
  let cacheArr = [];
  let currentPath = __dirname + '/cache.json';

  const readCacheConfig = () => {
    try {
      let parsed = JSON.parse(fs.readFileSync(currentPath));
      let {
        cache
      } = parsed;
      cacheArr = cache;
      return cacheArr;
    } catch (error) {
      return cacheArr;
    }
  };

  const checkCPUFree = async () => {
    getCPUUsage(i => {
      let formatted = Math.floor(i * 100); // return 'CPU Free: ' + `${formatted} %`;

      setCpuInfo('CPU Free: ' + `${formatted} %`);
    }, true);
  };

  const checkFreeMem = async () => {
    let formatted = Math.floor(os.freememPercentage() * 100);
    setMemInfo('Mem Free: ' + `${formatted} %`);
  };

  const checkSys = async flag => {
    readCacheConfig();
    let res = await checkCPUFree();

    if (!res) {
      checkFreeMem();
      getAllDriveSpaces();
    }
  };

  function getAllDriveSpaces() {
    child.exec('wmic logicaldisk get name', (error, stdout) => {
      if (cacheArr.length == 0) {
        let captureDrives = stdout.split('\r\r\n').filter(value => /[A-Za-z]:/.test(value)).map(value => value.trim());
        fs.writeFile(currentPath, JSON.stringify({
          cache: captureDrives
        }), function (err) {
          if (err) {
            return console.log(err);
          }
        });
        captureDrives.forEach(path => getFreeSpace(path));
      } else {
        cacheArr.forEach(path => getFreeSpace(path));
      }
    });
  }

  ;

  function getFreeSpace(path) {
    diskspace.check(path, function (err, result) {
      let percent = Math.floor(result.used / result.total * 100);
      let totalByteReducer = Math.floor(result.total / 1000000000);
      let tbr = totalByteReducer.toString();

      if (tbr.toString().length >= 4) {
        totalByteReducer = tbr[0] + 'TB';
      } else if (tbr[0] == 2 && tbr[1] == 5) {
        totalByteReducer = '256' + 'GB';
      } else {
        totalByteReducer = tbr + 'GB';
      }

      if (percent) {
        if (!diskInfo[path]) {
          diskInfo[path] = `\\ ` + totalByteReducer + ' ' + `${percent} %`;
          diskArr.push(path);
        } // console.log(diskInfo)
        // setDiskInfo(path + `\\ ` + totalByteReducer + ' ' + `${percent} %`);

      }
    });
  }

  ;

  function getCPUInfo(callback) {
    let cpus = _os.cpus();

    let user = 0;
    let nice = 0;
    let sys = 0;
    let idle = 0;
    let irq = 0;
    let total = 0;

    for (let cpu in cpus) {
      user += cpus[cpu].times.user;
      nice += cpus[cpu].times.nice;
      sys += cpus[cpu].times.sys;
      irq += cpus[cpu].times.irq;
      idle += cpus[cpu].times.idle;
    }

    total = user + nice + sys + idle + irq;
    return {
      'idle': idle,
      'total': total
    };
  }

  function getCPUUsage(callback, free) {
    let stats1 = getCPUInfo();
    let startIdle = stats1.idle;
    let startTotal = stats1.total;
    setTimeout(function () {
      let stats2 = getCPUInfo();
      let endIdle = stats2.idle;
      let endTotal = stats2.total;
      let idle = endIdle - startIdle;
      let total = endTotal - startTotal;
      let perc = idle / total;
      if (free === true) callback(perc);else callback(1 - perc);
    }, 100);
  }

  function driveDisplayMap() {
    return diskArr.map((i, idx) => {
      return /*#__PURE__*/React.createElement(Box, {
        key: idx
      }, /*#__PURE__*/React.createElement(Text, {
        color: "green"
      }, i + diskInfo[i]));
    });
  }

  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Box, {
    justifyContent: "center",
    flexDirection: "column",
    borderColor: "blueBright",
    borderStyle: "round"
  }, /*#__PURE__*/React.createElement(Box, {
    justifyContent: "center",
    alignItems: "center",
    flexDirection: "column",
    borderColor: "blueBright",
    borderStyle: "round"
  }, /*#__PURE__*/React.createElement(Gradient, {
    name: "mind"
  }, /*#__PURE__*/React.createElement(BigText, {
    font: fonts[2],
    lineHeight: 1,
    text: "Sys-Rsrc"
  }))), /*#__PURE__*/React.createElement(Box, {
    justifyContent: "center"
  }, /*#__PURE__*/React.createElement(Box, {
    flexDirection: "column",
    alignItems: "center",
    paddingRight: "1vw"
  }, /*#__PURE__*/React.createElement(Box, null, /*#__PURE__*/React.createElement(Text, {
    color: "green"
  }, cpuInfo)), /*#__PURE__*/React.createElement(Box, null, /*#__PURE__*/React.createElement(Text, {
    color: "green"
  }, memInfo))), /*#__PURE__*/React.createElement(Box, {
    flexDirection: "column",
    alignItems: "center",
    paddingLeft: "1vw"
  }, driveDisplayMap()))));
};

module.exports = App;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInVpLmpzIl0sIm5hbWVzIjpbImNoaWxkIiwicmVxdWlyZSIsImNwdVVzYWdlIiwiZGlza3NwYWNlIiwiZnMiLCJvcyIsIl9vcyIsIlJlYWN0IiwicmVuZGVyIiwidXNlRm9jdXMiLCJUZXh0IiwiQm94IiwiRGl2aWRlciIsIkdyYWRpZW50IiwiQmlnVGV4dCIsIlNwaW5uZXIiLCJjbGlTcGlubmVycyIsIkFwcCIsImNwdUluZm8iLCJzZXRDcHVJbmZvIiwidXNlU3RhdGUiLCJkaXNrSW5mbyIsInNldERpc2tJbmZvIiwiZGlza0FyciIsInNldERpc2tBcnIiLCJtZW1JbmZvIiwic2V0TWVtSW5mbyIsImZvbnQiLCJzZXRGb250IiwiY291bnQiLCJzZXRDb3VudCIsImZvbnRzIiwic2V0Rm9udHMiLCJ1c2VFZmZlY3QiLCJzZXRJbnRlcnZhbCIsImNoZWNrU3lzIiwiY2hlY2tGcmVlTWVtIiwiY2FjaGVBcnIiLCJjdXJyZW50UGF0aCIsIl9fZGlybmFtZSIsInJlYWRDYWNoZUNvbmZpZyIsInBhcnNlZCIsIkpTT04iLCJwYXJzZSIsInJlYWRGaWxlU3luYyIsImNhY2hlIiwiZXJyb3IiLCJjaGVja0NQVUZyZWUiLCJnZXRDUFVVc2FnZSIsImkiLCJmb3JtYXR0ZWQiLCJNYXRoIiwiZmxvb3IiLCJmcmVlbWVtUGVyY2VudGFnZSIsImZsYWciLCJyZXMiLCJnZXRBbGxEcml2ZVNwYWNlcyIsImV4ZWMiLCJzdGRvdXQiLCJsZW5ndGgiLCJjYXB0dXJlRHJpdmVzIiwic3BsaXQiLCJmaWx0ZXIiLCJ2YWx1ZSIsInRlc3QiLCJtYXAiLCJ0cmltIiwid3JpdGVGaWxlIiwic3RyaW5naWZ5IiwiZXJyIiwiY29uc29sZSIsImxvZyIsImZvckVhY2giLCJwYXRoIiwiZ2V0RnJlZVNwYWNlIiwiY2hlY2siLCJyZXN1bHQiLCJwZXJjZW50IiwidXNlZCIsInRvdGFsIiwidG90YWxCeXRlUmVkdWNlciIsInRiciIsInRvU3RyaW5nIiwicHVzaCIsImdldENQVUluZm8iLCJjYWxsYmFjayIsImNwdXMiLCJ1c2VyIiwibmljZSIsInN5cyIsImlkbGUiLCJpcnEiLCJjcHUiLCJ0aW1lcyIsImZyZWUiLCJzdGF0czEiLCJzdGFydElkbGUiLCJzdGFydFRvdGFsIiwic2V0VGltZW91dCIsInN0YXRzMiIsImVuZElkbGUiLCJlbmRUb3RhbCIsInBlcmMiLCJkcml2ZURpc3BsYXlNYXAiLCJpZHgiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFDQSxNQUFNQSxLQUFLLEdBQUdDLE9BQU8sQ0FBQyxlQUFELENBQXJCOztBQUNBLE1BQU07QUFBRUMsRUFBQUE7QUFBRixJQUFlRCxPQUFPLENBQUMsU0FBRCxDQUE1Qjs7QUFDQSxJQUFJRSxTQUFTLEdBQUdGLE9BQU8sQ0FBQyxXQUFELENBQXZCOztBQUNBLE1BQU1HLEVBQUUsR0FBR0gsT0FBTyxDQUFDLElBQUQsQ0FBbEI7O0FBQ0EsSUFBSUksRUFBRSxHQUFHSixPQUFPLENBQUMsVUFBRCxDQUFoQjs7QUFDQSxJQUFJSyxHQUFHLEdBQUdMLE9BQU8sQ0FBQyxJQUFELENBQWpCOztBQUNBLE1BQU1NLEtBQUssR0FBR04sT0FBTyxDQUFDLE9BQUQsQ0FBckI7O0FBQ0EsTUFBTTtBQUFFTyxFQUFBQSxNQUFGO0FBQVVDLEVBQUFBLFFBQVY7QUFBb0JDLEVBQUFBLElBQXBCO0FBQTBCQyxFQUFBQTtBQUExQixJQUFrQ1YsT0FBTyxDQUFDLEtBQUQsQ0FBL0M7O0FBQ0EsTUFBTVcsT0FBTyxHQUFHWCxPQUFPLENBQUMsYUFBRCxDQUF2Qjs7QUFDQSxNQUFNWSxRQUFRLEdBQUdaLE9BQU8sQ0FBQyxjQUFELENBQXhCOztBQUNBLE1BQU1hLE9BQU8sR0FBR2IsT0FBTyxDQUFDLGNBQUQsQ0FBdkIsQyxDQUNBOzs7QUFDQSxNQUFNYyxPQUFPLEdBQUdkLE9BQU8sQ0FBQyxhQUFELENBQXZCOztBQUNBLE1BQU1lLFdBQVcsR0FBR2YsT0FBTyxDQUFDLGNBQUQsQ0FBM0I7O0FBRUEsTUFBTWdCLEdBQUcsR0FBRyxNQUFN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LElBQUEsYUFBYSxFQUFDLFFBQW5CO0FBQTRCLElBQUEsVUFBVSxFQUFDLFFBQXZDO0FBQWdELElBQUEsWUFBWSxFQUFDO0FBQTdELGtCQUNDLG9CQUFDLEdBQUQscUJBQ0Msb0JBQUMsSUFBRDtBQUFNLElBQUEsS0FBSyxFQUFDO0FBQVosS0FBcUJiLE9BQXJCLENBREQsQ0FERCxlQUlDLG9CQUFDLEdBQUQscUJBQ0Msb0JBQUMsSUFBRDtBQUFNLElBQUEsS0FBSyxFQUFDO0FBQVosS0FBcUJPLE9BQXJCLENBREQsQ0FKRCxDQUhELGVBWUMsb0JBQUMsR0FBRDtBQUFLLElBQUEsYUFBYSxFQUFDLFFBQW5CO0FBQTRCLElBQUEsVUFBVSxFQUFDLFFBQXZDO0FBQWdELElBQUEsV0FBVyxFQUFDO0FBQTVELEtBQ0U4RSxlQUFlLEVBRGpCLENBWkQsQ0FkRCxDQURELENBREQ7QUFvQ0EsQ0F0TUQ7O0FBd01BRSxNQUFNLENBQUNDLE9BQVAsR0FBaUJ6RixHQUFqQiIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcbmNvbnN0IGNoaWxkID0gcmVxdWlyZSgnY2hpbGRfcHJvY2VzcycpO1xuY29uc3QgeyBjcHVVc2FnZSB9ID0gcmVxdWlyZSgncHJvY2VzcycpO1xubGV0IGRpc2tzcGFjZSA9IHJlcXVpcmUoJ2Rpc2tzcGFjZScpO1xuY29uc3QgZnMgPSByZXF1aXJlKCdmcycpO1xubGV0IG9zID0gcmVxdWlyZSgnb3MtdXRpbHMnKTtcbmxldCBfb3MgPSByZXF1aXJlKCdvcycpO1xuY29uc3QgUmVhY3QgPSByZXF1aXJlKCdyZWFjdCcpO1xuY29uc3QgeyByZW5kZXIsIHVzZUZvY3VzLCBUZXh0LCBCb3ggfSA9IHJlcXVpcmUoJ2luaycpO1xuY29uc3QgRGl2aWRlciA9IHJlcXVpcmUoJ2luay1kaXZpZGVyJyk7XG5jb25zdCBHcmFkaWVudCA9IHJlcXVpcmUoJ2luay1ncmFkaWVudCcpXG5jb25zdCBCaWdUZXh0ID0gcmVxdWlyZSgnaW5rLWJpZy10ZXh0Jyk7XG4vLyBjb25zdCBBc2NpaSA9IHJlcXVpcmUoJ2luay1hc2NpaScpXG5jb25zdCBTcGlubmVyID0gcmVxdWlyZSgnaW5rLXNwaW5uZXInKVxuY29uc3QgY2xpU3Bpbm5lcnMgPSByZXF1aXJlKCdjbGktc3Bpbm5lcnMnKTtcblxuY29uc3QgQXBwID0gKCkgPT4ge1xuXHRjb25zdCBbY3B1SW5mbywgc2V0Q3B1SW5mb10gPSBSZWFjdC51c2VTdGF0ZSgnJyk7XG5cdGNvbnN0IFtkaXNrSW5mbywgc2V0RGlza0luZm9dID0gUmVhY3QudXNlU3RhdGUoe30pO1xuXHRjb25zdCBbZGlza0Fyciwgc2V0RGlza0Fycl0gPSBSZWFjdC51c2VTdGF0ZShbXSk7XG5cdGNvbnN0IFttZW1JbmZvLCBzZXRNZW1JbmZvXSA9IFJlYWN0LnVzZVN0YXRlKCcnKTtcblx0Y29uc3QgW2ZvbnQsIHNldEZvbnRdID0gUmVhY3QudXNlU3RhdGUoJycpO1xuXHRjb25zdCBbY291bnQsIHNldENvdW50XSA9IFJlYWN0LnVzZVN0YXRlKDApO1xuXG5cblx0Y29uc3QgW2ZvbnRzLCBzZXRGb250c10gPSBSZWFjdC51c2VTdGF0ZShbXG5cdFx0J2Jsb2NrJyxcblx0XHQnc2xpY2snLFxuXHRcdCd0aW55Jyxcblx0XHQnZ3JpZCcsXG5cdFx0J3BhbGxldCcsXG5cdFx0J3NoYWRlJyxcblx0XHQnc2ltcGxlJyxcblx0XHQnc2ltcGxlQmxvY2snLFxuXHRcdCczZCcsXG5cdFx0J3NpbXBsZTNkJyxcblx0XHQnY2hyb21lJyxcblx0XHQnaHVnZScsXG5cdF0pXG5cblx0UmVhY3QudXNlRWZmZWN0KCgpID0+IHtcblx0XHRzZXRJbnRlcnZhbCgoKSA9PiB7XG5cdFx0XHRjaGVja1N5cygpO1xuXHRcdFx0Y2hlY2tGcmVlTWVtKCk7XG5cdFx0XHQvL3NldENvdW50KHByZXYgPT4gcHJldisxKVxuXHRcdH0sIDEwMDApXG5cdH0sIFtdKVxuXG5cblx0bGV0IGNhY2hlQXJyID0gW107XG5cdGxldCBjdXJyZW50UGF0aCA9IF9fZGlybmFtZSArICcvY2FjaGUuanNvbic7XG5cblx0Y29uc3QgcmVhZENhY2hlQ29uZmlnID0gKCkgPT4ge1xuXHRcdHRyeSB7XG5cdFx0XHRsZXQgcGFyc2VkID0gSlNPTi5wYXJzZShmcy5yZWFkRmlsZVN5bmMoY3VycmVudFBhdGgpKTtcblx0XHRcdGxldCB7IGNhY2hlIH0gPSBwYXJzZWQ7XG5cdFx0XHRjYWNoZUFyciA9IGNhY2hlO1xuXHRcdFx0cmV0dXJuIGNhY2hlQXJyXG5cdFx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRcdHJldHVybiBjYWNoZUFycjtcblx0XHR9XG5cdH07XG5cblx0Y29uc3QgY2hlY2tDUFVGcmVlID0gYXN5bmMgKCkgPT4ge1xuXHRcdGdldENQVVVzYWdlKGkgPT4ge1xuXHRcdFx0bGV0IGZvcm1hdHRlZCA9IE1hdGguZmxvb3IoaSAqIDEwMClcblx0XHRcdC8vIHJldHVybiAnQ1BVIEZyZWU6ICcgKyBgJHtmb3JtYXR0ZWR9ICVgO1xuXHRcdFx0c2V0Q3B1SW5mbygnQ1BVIEZyZWU6ICcgKyBgJHtmb3JtYXR0ZWR9ICVgKTtcblxuXHRcdH0sIHRydWUpXG5cdH07XG5cblx0Y29uc3QgY2hlY2tGcmVlTWVtID0gYXN5bmMgKCkgPT4ge1xuXHRcdGxldCBmb3JtYXR0ZWQgPSBNYXRoLmZsb29yKG9zLmZyZWVtZW1QZXJjZW50YWdlKCkgKiAxMDApXG5cdFx0c2V0TWVtSW5mbygnTWVtIEZyZWU6ICcgKyBgJHtmb3JtYXR0ZWR9ICVgKTtcblx0fTtcblxuXHRjb25zdCBjaGVja1N5cyA9IGFzeW5jIChmbGFnKSA9PiB7XG5cdFx0cmVhZENhY2hlQ29uZmlnKCk7XG5cdFx0bGV0IHJlcyA9IGF3YWl0IGNoZWNrQ1BVRnJlZSgpXG5cdFx0aWYgKCFyZXMpIHtcblx0XHRcdGNoZWNrRnJlZU1lbSgpXG5cdFx0XHRnZXRBbGxEcml2ZVNwYWNlcygpO1xuXHRcdH1cblx0fTtcblxuXHRmdW5jdGlvbiBnZXRBbGxEcml2ZVNwYWNlcygpIHtcblx0XHRjaGlsZC5leGVjKCd3bWljIGxvZ2ljYWxkaXNrIGdldCBuYW1lJywgKGVycm9yLCBzdGRvdXQpID0+IHtcblxuXHRcdFx0aWYgKGNhY2hlQXJyLmxlbmd0aCA9PSAwKSB7XG5cdFx0XHRcdGxldCBjYXB0dXJlRHJpdmVzID0gc3Rkb3V0LnNwbGl0KCdcXHJcXHJcXG4nKS5maWx0ZXIodmFsdWUgPT4gL1tBLVphLXpdOi8udGVzdCh2YWx1ZSkpLm1hcCh2YWx1ZSA9PiB2YWx1ZS50cmltKCkpXG5cdFx0XHRcdGZzLndyaXRlRmlsZShjdXJyZW50UGF0aCwgSlNPTi5zdHJpbmdpZnkoeyBjYWNoZTogY2FwdHVyZURyaXZlcyB9KSwgZnVuY3Rpb24gKGVycikge1xuXHRcdFx0XHRcdGlmIChlcnIpIHtcblx0XHRcdFx0XHRcdHJldHVybiBjb25zb2xlLmxvZyhlcnIpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0XHRcdGNhcHR1cmVEcml2ZXMuZm9yRWFjaChwYXRoID0+IGdldEZyZWVTcGFjZShwYXRoKSlcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGNhY2hlQXJyLmZvckVhY2gocGF0aCA9PiBnZXRGcmVlU3BhY2UocGF0aCkpXG5cdFx0XHR9XG5cdFx0fSlcblx0fTtcblxuXHRmdW5jdGlvbiBnZXRGcmVlU3BhY2UocGF0aCkge1xuXHRcdGRpc2tzcGFjZS5jaGVjayhwYXRoLCBmdW5jdGlvbiAoZXJyLCByZXN1bHQpIHtcblx0XHRcdGxldCBwZXJjZW50ID0gTWF0aC5mbG9vcihyZXN1bHQudXNlZCAvIHJlc3VsdC50b3RhbCAqIDEwMClcblx0XHRcdGxldCB0b3RhbEJ5dGVSZWR1Y2VyID0gTWF0aC5mbG9vcihyZXN1bHQudG90YWwgLyAxMDAwMDAwMDAwKVxuXHRcdFx0bGV0IHRiciA9IHRvdGFsQnl0ZVJlZHVjZXIudG9TdHJpbmcoKVxuXHRcdFx0aWYgKHRici50b1N0cmluZygpLmxlbmd0aCA+PSA0KSB7XG5cdFx0XHRcdHRvdGFsQnl0ZVJlZHVjZXIgPSB0YnJbMF0gKyAnVEInXG5cdFx0XHR9IGVsc2UgaWYgKHRiclswXSA9PSAyICYmIHRiclsxXSA9PSA1KSB7XG5cdFx0XHRcdHRvdGFsQnl0ZVJlZHVjZXIgPSAnMjU2JyArICdHQidcblx0XHRcdH1cblx0XHRcdGVsc2Uge1xuXHRcdFx0XHR0b3RhbEJ5dGVSZWR1Y2VyID0gdGJyICsgJ0dCJ1xuXHRcdFx0fVxuXHRcdFx0aWYgKHBlcmNlbnQpIHtcblx0XHRcdFx0aWYgKCFkaXNrSW5mb1twYXRoXSkge1xuXHRcdFx0XHRcdGRpc2tJbmZvW3BhdGhdID0gYFxcXFwgYCArIHRvdGFsQnl0ZVJlZHVjZXIgKyAnICcgKyBgJHtwZXJjZW50fSAlYFxuXHRcdFx0XHRcdGRpc2tBcnIucHVzaChwYXRoKVxuXHRcdFx0XHR9XG5cdFx0XHRcdC8vIGNvbnNvbGUubG9nKGRpc2tJbmZvKVxuXHRcdFx0XHQvLyBzZXREaXNrSW5mbyhwYXRoICsgYFxcXFwgYCArIHRvdGFsQnl0ZVJlZHVjZXIgKyAnICcgKyBgJHtwZXJjZW50fSAlYCk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH07XG5cdGZ1bmN0aW9uIGdldENQVUluZm8oY2FsbGJhY2spIHtcblx0XHRsZXQgY3B1cyA9IF9vcy5jcHVzKCk7XG5cdFx0bGV0IHVzZXIgPSAwO1xuXHRcdGxldCBuaWNlID0gMDtcblx0XHRsZXQgc3lzID0gMDtcblx0XHRsZXQgaWRsZSA9IDA7XG5cdFx0bGV0IGlycSA9IDA7XG5cdFx0bGV0IHRvdGFsID0gMDtcblx0XHRmb3IgKGxldCBjcHUgaW4gY3B1cykge1xuXHRcdFx0dXNlciArPSBjcHVzW2NwdV0udGltZXMudXNlcjtcblx0XHRcdG5pY2UgKz0gY3B1c1tjcHVdLnRpbWVzLm5pY2U7XG5cdFx0XHRzeXMgKz0gY3B1c1tjcHVdLnRpbWVzLnN5cztcblx0XHRcdGlycSArPSBjcHVzW2NwdV0udGltZXMuaXJxO1xuXHRcdFx0aWRsZSArPSBjcHVzW2NwdV0udGltZXMuaWRsZTtcblx0XHR9XG5cdFx0dG90YWwgPSB1c2VyICsgbmljZSArIHN5cyArIGlkbGUgKyBpcnE7XG5cdFx0cmV0dXJuIHtcblx0XHRcdCdpZGxlJzogaWRsZSxcblx0XHRcdCd0b3RhbCc6IHRvdGFsXG5cdFx0fTtcblx0fVxuXHRmdW5jdGlvbiBnZXRDUFVVc2FnZShjYWxsYmFjaywgZnJlZSkge1xuXHRcdGxldCBzdGF0czEgPSBnZXRDUFVJbmZvKCk7XG5cdFx0bGV0IHN0YXJ0SWRsZSA9IHN0YXRzMS5pZGxlO1xuXHRcdGxldCBzdGFydFRvdGFsID0gc3RhdHMxLnRvdGFsO1xuXG5cdFx0c2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG5cdFx0XHRsZXQgc3RhdHMyID0gZ2V0Q1BVSW5mbygpO1xuXHRcdFx0bGV0IGVuZElkbGUgPSBzdGF0czIuaWRsZTtcblx0XHRcdGxldCBlbmRUb3RhbCA9IHN0YXRzMi50b3RhbDtcblxuXHRcdFx0bGV0IGlkbGUgPSBlbmRJZGxlIC0gc3RhcnRJZGxlO1xuXHRcdFx0bGV0IHRvdGFsID0gZW5kVG90YWwgLSBzdGFydFRvdGFsO1xuXHRcdFx0bGV0IHBlcmMgPSBpZGxlIC8gdG90YWw7XG5cblx0XHRcdGlmIChmcmVlID09PSB0cnVlKVxuXHRcdFx0XHRjYWxsYmFjayhwZXJjKTtcblx0XHRcdGVsc2Vcblx0XHRcdFx0Y2FsbGJhY2soKDEgLSBwZXJjKSk7XG5cdFx0fSwgMTAwKTtcblx0fVxuXHRmdW5jdGlvbiBkcml2ZURpc3BsYXlNYXAoKSB7XG5cdFx0cmV0dXJuIGRpc2tBcnIubWFwKChpLCBpZHgpID0+IHtcblx0XHRcdHJldHVybiAoXG5cdFx0XHRcdDxCb3gga2V5PXtpZHh9PlxuXHRcdFx0XHRcdDxUZXh0IGNvbG9yPVwiZ3JlZW5cIj57aSArIGRpc2tJbmZvW2ldfTwvVGV4dD5cblx0XHRcdFx0PC9Cb3g+XG5cdFx0XHQpXG5cdFx0fSlcblx0fVxuXG5cblx0cmV0dXJuIChcblx0XHQ8PlxuXHRcdFx0PEJveCBqdXN0aWZ5Q29udGVudD0nY2VudGVyJyBmbGV4RGlyZWN0aW9uPSdjb2x1bW4nIGJvcmRlckNvbG9yPSdibHVlQnJpZ2h0JyBib3JkZXJTdHlsZT0ncm91bmQnPlxuXHRcdFx0XHR7LyogPFRleHQgY29sb3I9XCJncmVlblwiPlxuXHRcdFx0XHRcdDxTcGlubmVyIHR5cGU9XCJkb3RzXCIgLz5cblx0XHRcdFx0XHR7JyBMb2FkaW5nJ31cblx0XHRcdFx0PC9UZXh0PiAqL31cblx0XHRcdFx0PEJveCBqdXN0aWZ5Q29udGVudD0nY2VudGVyJyBhbGlnbkl0ZW1zPSdjZW50ZXInIGZsZXhEaXJlY3Rpb249J2NvbHVtbicgYm9yZGVyQ29sb3I9J2JsdWVCcmlnaHQnIGJvcmRlclN0eWxlPSdyb3VuZCcgPlxuXHRcdFx0XHRcdHsvKiA8QXNjaWkgIC8+ICovfVxuXHRcdFx0XHRcdDxHcmFkaWVudCBuYW1lPVwibWluZFwiPlxuXHRcdFx0XHRcdFx0PEJpZ1RleHQgZm9udD17Zm9udHNbMl19IGxpbmVIZWlnaHQ9ezF9IHRleHQ9XCJTeXMtUnNyY1wiIC8+XG5cdFx0XHRcdFx0PC9HcmFkaWVudD5cblx0XHRcdFx0XHR7LyogPFRleHQ+e2ZvbnRzLmluZGV4T2YoZm9udHNbY291bnRdKX08L1RleHQ+ICovfVxuXHRcdFx0XHRcdHsvKiA8RGl2aWRlciB0aXRsZT17J1Jlc291cmNlIE1vbml0b3IgMS4wJ30gZGl2aWRlckNvbG9yPSdibHVlJyAvPiAqL31cblx0XHRcdFx0PC9Cb3g+XG5cblx0XHRcdFx0PEJveCBqdXN0aWZ5Q29udGVudD0nY2VudGVyJz5cblxuXG5cdFx0XHRcdFx0PEJveCBmbGV4RGlyZWN0aW9uPSdjb2x1bW4nIGFsaWduSXRlbXM9J2NlbnRlcicgcGFkZGluZ1JpZ2h0PScxdncnPlxuXHRcdFx0XHRcdFx0PEJveCA+XG5cdFx0XHRcdFx0XHRcdDxUZXh0IGNvbG9yPVwiZ3JlZW5cIj57Y3B1SW5mb308L1RleHQ+XG5cdFx0XHRcdFx0XHQ8L0JveD5cblx0XHRcdFx0XHRcdDxCb3g+XG5cdFx0XHRcdFx0XHRcdDxUZXh0IGNvbG9yPVwiZ3JlZW5cIj57bWVtSW5mb308L1RleHQ+XG5cdFx0XHRcdFx0XHQ8L0JveD5cblx0XHRcdFx0XHQ8L0JveD5cblxuXHRcdFx0XHRcdDxCb3ggZmxleERpcmVjdGlvbj0nY29sdW1uJyBhbGlnbkl0ZW1zPSdjZW50ZXInIHBhZGRpbmdMZWZ0PScxdncnPlxuXHRcdFx0XHRcdFx0e2RyaXZlRGlzcGxheU1hcCgpfVxuXHRcdFx0XHRcdDwvQm94PlxuXG5cdFx0XHRcdDwvQm94PlxuXHRcdFx0PC9Cb3g+XG5cdFx0PC8+XG5cdClcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gQXBwO1xuIl19